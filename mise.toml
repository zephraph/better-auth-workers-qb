[tools]
bun = "1.2.19"

[env]
_.path = "node_modules/.bin"
_.file = ".env"

[hooks]
postinstall = "bun install"

[tasks.build]
depends = ["build:modules", "build:types"]
description = "Build the complete project"

[tasks."build:modules"]
run = "./scripts/build-modules.sh"
description = "Build JavaScript modules from TypeScript"

[tasks."build:types"]
run = "./scripts/build-types.sh"
description = "Generate TypeScript declaration files"

[tasks."build:clean"]
run = "rm -rf dist"
description = "Clean build artifacts"

[tasks.type-check]
run = "tsc --noEmit"
description = "Type check the project"

[tasks.dev]
run = "bun run src/index.ts"
description = "Run development server"

[tasks.test]
depends = ["build"]
run = "node test-migrations.js"
description = "Build and run all tests"

[tasks."test:migrations"]
run = "node test-migrations.js"
description = "Run migration system tests"

[tasks."test:bun"]
run = "bun test"
description = "Run bun tests (when working)"

[tasks.test-watch]
run = "bun test --watch"
description = "Run tests in watch mode"

[tasks.prepublishOnly]
run = "build"
description = "Prepare for publishing"

[tasks.fmt]
run = "biome check --write --unsafe ."
description = "Format and fix code with Biome"

[tasks.example]
run = "bun run dev"
dir = "example"
depends = ["install:example"]
description = "Run the Cloudflare D1 example application"

[tasks."install:example"]
run = "bun install"
dir = "example"
description = "Install dependencies for the example application"
